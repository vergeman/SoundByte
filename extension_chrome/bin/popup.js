function render_loading(){console.log("render_loading()"),$("#sb-error").hide(),$("#sb-track").hide(),$("#sb-submit").hide(),$("#sb-sleep").hide(),$("#sb-loading").show(),$("#sb-app").show()}function render_sleep(){console.log("render_sleep()"),$("#sb-error").hide(),$("#sb-track").hide(),$("#sb-submit").hide(),$("#sb-loading").hide(),$("#sb-sleep").show(),$("#sb-app").show()}function render_no_service(){console.log("render_no_service()"),$("#sb-loading").hide(),$("#sb-track").hide(),$("#sb-submit").hide(),$("#sb-sleep").hide(),$("#sb-error").show(),$("#sb-app").show()}function render_active(){console.log("render_active()"),$("#sb-loading").hide(),$("#sb-error").hide(),$("#sb-sleep").hide(),$("#sb-track").show(),$("#sb-submit").show(),$("#sb-app").show()}function bind_buttons(){$("#sb-close").bind("click",function(){console.log("[stereopaw 2.0] extension Exit"),window.close()}),$("#sb-submit-button").click(function(e){e.preventDefault(),window.open(url,"stereopaw","top=0,left=0,width=600, height=675"),$("#sb-close").click()})}function detect_play(service,tab){if(console.log("detect_play()"),!tab)return!1;var tab_id=tab.id,insert=function(args){var service=args[0],extension_id=args[1],is_playing={soundcloud:function(args){var _extension_id=args[0],result=!1,sc_mgr=require("lib/play-manager");try{result=sc_mgr.getCurrentMetadata().sound.audio._isPlaying}catch(e){}chrome.runtime.sendMessage(_extension_id,{launchable:result})},youtube:function(args){var _extension_id=args[0],result=!1;try{var _player=document.getElementById("movie_player"),_state=_player.getPlayerState();1==_state&&(result=!0)}catch(e){}chrome.runtime.sendMessage(_extension_id,{launchable:result})},mixcloud:function(){},spotify:function(){}},script=document.createElement("script");script.textContent="("+is_playing[service]+")("+JSON.stringify([extension_id])+");",document.head.appendChild(script),script.parentNode.removeChild(script)},code_obj={code:"("+insert+")("+JSON.stringify([service,chrome.runtime.id])+");"};return chrome.tabs.executeScript(tab_id,code_obj),!0}var LAUNCHED=!1;chrome.runtime.onMessageExternal.addListener(function(request,sender){request.launchable&&!LAUNCHED&&(console.log("RECEIVED LAUNCH MSG"),LAUNCHED=!0,chrome.tabs.executeScript(sender.tab.id,{code:"(function(){document.getElementById('sb-app') ? false : (function() {var e = document.createElement('script');e.setAttribute('id', 'sb-script');e.setAttribute('mode', 'extension');e.setAttribute('src','https://ec2-54-220-193-184.eu-west-1.compute.amazonaws.com:5151/stereopaw-min.js?r='+Math.random()*99999999);document.body.appendChild(e)})() }())"})),request.launchable||LAUNCHED||(LAUNCHED=!0,console.log("sleep"),bind_buttons(),render_sleep())});var run=function(){render_loading();var results=[],urls={soundcloud:"*://*.soundcloud.com/*",mixcloud:"*://*.mixcloud.com/*",youtube:"*://*.youtube.com/*",spotify:"*://*.spotify.com/*"},check_detect=function(i){i==Object.keys(urls).length-1&&0==results.length&&(console.log("nothing detected"),bind_buttons(),render_no_service())},i=0;for(var url in urls){console.log(url);{(function(url){chrome.tabs.query({url:urls[url]},function(tabs){console.log("TAB"),console.log(tabs);for(var tab in tabs)results.push(detect_play(url,tabs[tab]));check_detect(i),i+=1})})(url)}}},PAGE_INSERTED=!1,url;chrome.runtime.onMessageExternal.addListener(function(request){console.log("RECV EXTENSION"),request.track&&!PAGE_INSERTED&&(console.log("Inserting Page"),PAGE_INSERTED=!0,bind_buttons(),render_active()),request.track&&($("#sb-track").show(),request.track.title?document.getElementById("sb-track-title").innerHTML=request.track.title:(document.getElementById("sb-track-title").innerHTML="",$("#sb-track-title-label").hide()),request.track.artist?document.getElementById("sb-track-artist").innerHTML=request.track.artist:(document.getElementById("sb-track-artist").innerHTML="",$("#sb-track-artist-label").hide()),document.getElementById("sb-time").innerHTML=request.track.timeformat,url=request.track.url)}),chrome.extension.connect(),run();