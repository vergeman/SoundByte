chrome.runtime.onMessageExternal.addListener(function(request,sender){if(console.log("SERVICE"),request.URL){var service=request.service,timestamp=request.time,url=request.URL,stereopaw_tab=sender.tab,insert=function(args){var _service=args[0],_time=args[1],_tab_id=args[2],_stereopawtab_id=args[3],mixcloud="("+function(args){{var time=args[0];args[1],args[2]}x=$(".player").scope(),x.volume=0,x.playerStarted||x.playing||(x.volume=0,$(".cloudcast-play").click());var checkExist=setInterval(function(){x.volume=0,x.playerStarted&&x.playing&&!x.loading&&(x.$apply(function(){x.$emit("slider:stop",time/1e3),x.volume=1}),clearInterval(checkExist))},100)}+")("+JSON.stringify([_time,_tab_id,_stereopawtab_id])+")",spotify="("+function(args){var time=args[0],checkExist=(args[1],args[2],setInterval(function(){window.frames[1]&&window.frames[1].require&&window.frames[1].require(["$api/models"],function(models){player=models.player,models.player.load("track").done(function(){if(player.track&&player.track.number&&player.track.album&&(player.track.uri.contains("spotify:track")||player.track.uri.contains("spotify:album"))){clearInterval(checkExist),_album=player.track.album,_number=player.track.number,player.stop(),player.playContext(_album,_number-1,time);var next=function(){player.stop(),player.playContext(_album,_number,0)},kill=function(){player.removeEventListener("change:track",next)};player.addEventListener("change:track",next),player.addEventListener("change:track",kill)}})})},500))}+")("+JSON.stringify([_time,_tab_id,_stereopawtab_id])+")",script=document.createElement("script");"mixcloud"==_service&&(script.textContent=mixcloud),"spotify"==_service&&(script.textContent=spotify),"another"==_service&&(script.textContent="another"),(document.head||document.documentElement).appendChild(script),script.parentNode.removeChild(script)};chrome.tabs.create({url:url},function(tab){chrome.tabs.executeScript(null,{code:"("+insert+")("+JSON.stringify([service,timestamp,tab.id,stereopaw_tab.id])+");"})})}});var connect_listener=function(port){console.log("[Stereopaw BG] connect_listener: connected");var port_listener=function(){console.log("[Stereopaw BG] port listener");var msg_listener=function(request,sender,sendResponse){console.log("[Stereopaw BG] msg_listener"),request.track&&(console.log("BG: sending shutdown response"),sendResponse({shutdown:!0})),console.log("remove listener"),chrome.runtime.onMessageExternal.removeListener(msg_listener)};chrome.runtime.onMessageExternal.addListener(msg_listener),port.onDisconnect.removeListener(port_listener)};port.onDisconnect.addListener(port_listener)};chrome.extension.onConnect.addListener(connect_listener);