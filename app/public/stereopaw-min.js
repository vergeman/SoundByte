console.log("[stereopaw 2.0]"),HOST="https://ec2-54-220-193-184.eu-west-1.compute.amazonaws.com:5151",EXTENSION_ID="nhdgndjpbheaiiconnkbgbblmpfhkeki";var MODE={MARKLET:0,EXTENSION:1},SB=function(){var a,b=null,c=null,d={init:function(){b=this,b.Util.load_jQuery(),c=setInterval(function(){return void 0==$&&null!=jQuery&&($=jQuery),"undefined"==typeof jQuery?!1:(clearInterval(c),c=null,b.start(),void 0)},150)},start:function(){console.log("[stereopaw 2.0] start()"),b.service=b.Service.getService(),console.log("Service: "+b.service),a=window.chrome&&document.getElementById("sb-script").getAttribute("mode")?MODE.EXTENSION:MODE.MARKLET,console.log("mode: "+a),a!=MODE.MARKLET||document.getElementById("sb-app")||("NA"==b.service?b.Page.insert_error_page():b.Page.insert_page(),b.events()),b.update()},events:function(){console.log("[stereopaw 2.0] events()"),$("#sb-close").bind("click",function(){console.log("[stereopaw 2.0] Exiting"),clearInterval(b._interval),b._interval=null,$("#sb-submit-button").unbind("click"),$("#sb-close").unbind("click"),$("#sb-script").remove(),$("#sb-style").remove(),$("#sb-app").remove()}),$("#sb-submit-button").bind("click",function(a){a.preventDefault(),window.open(b.Track.getURL(),"stereopaw","top=0,left=0,width=600, height=675"),console.log("clicked"),$("#sb-close").click(),console.log("closing")}),$("#sb-display-bar").mouseover(function(){$("#sb-display-seek").show()}),$("#sb-display-bar").mouseout(function(){$("#sb-display-seek").hide()}),$("#sb-display-bar").mousemove(function(a){var b=$(this).parent().offset(),c=a.pageX-b.left;$("#sb-display-seek").css("left",c+"px")}),$("#sb-display-bar").click(function(a){console.log("seek");var c=$(this).parent().offset(),d=a.pageX-c.left;b.Data.seek(d/$("#sb-display-bar").width())})},update:function(){console.log("[stereopaw 2.0] update()"),b._interval=setInterval(function(){console.log("[stereopaw 2.0] setInterval"),b.Data.setTrack(a,b.service,b.Track),a==MODE.MARKLET?b.render():b.sendExtension()},400)},sendExtension:function(){console.log("[stereopaw 2.0] sendExtension()");var a;a="NA"==b.service?{error:!0}:{track:b.Track.toJSON()},console.log(a);var c=function(b){console.log("cb"),b.shutdown&&(console.log("Shutting down"),console.log(a),clearInterval(SB._interval),SB._interval=null)};console.log("stereopaw 2.0 sending msg"),chrome.runtime.sendMessage(EXTENSION_ID,a,c)},render:function(){console.log("[stereopaw 2.0] render()"),$("#sb-app").is(":hidden")&&$("#sb-app").fadeIn(),"NA"!=b.service&&(b.Track.getTitle()?document.getElementById("sb-track-title").innerHTML=b.Track.getTitle():document.getElementById("sb-track-title-label").style.display="none",b.Track.getArtist()?"":document.getElementById("sb-track-artist-label").style.display="none",document.getElementById("sb-track-artist").innerHTML=b.Track.getArtist(),b.Track.getTimeFormat()?document.getElementById("sb-time").innerHTML=b.Track.getTimeFormat():document.getElementById("sb-track-time-label").style.display="none")}};return d}();SB.Util=function(){function a(a){return a.toFixed().length>1?a.toFixed():"0"+a.toFixed()}function b(b,c,d){return 1>b?c+":"+a(d):b+":"+a(c)+":"+a(d)}var c={};return c.textToSecs=function(a,b,c){var d=0;return a&&(d+=parseInt(3600*a[0].match(/\d+/)[0])),b&&(d+=parseInt(60*b[0].match(/\d+/)[0])),c&&(d+=parseInt(c)),d},c.TimetoMs=function(a){return min=a.split(":")[0],sec=a.split(":")[1],60*min*1e3+1e3*sec},c.toTime=function(a,c){var d="secs"==c?1:1e3,e=Math.floor(a/(3600*d)),f=Math.floor(a/(60*d)-60*e),g=60*(a/(60*d)-60*e-f);return"secs"==c?b(e,f,Math.round(g)):b(e,f,Math.floor(g))},c.load_jQuery=function(){if("undefined"==typeof jQuery){var a=document.createElement("script");a.id="sb-jb",a.type="text/javascript",a.src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js",document.body.appendChild(a)}},c}(),SB.Page=function(){function a(b){css="";for(key in b)b.hasOwnProperty(key)&&"object"==typeof b[key]&&(css+=key+"{"+a(b[key])+"}"),b.hasOwnProperty(key)&&"string"==typeof b[key]&&(css+=key+":"+b[key]+";");return css}function b(a,b){var c=document.createElement(a.type);c.setAttribute(a.attr,a.value),c.innerHTML=b,document.body.appendChild(c)}var c="https://ec2-54-220-193-184.eu-west-1.compute.amazonaws.com:5151",d=['<div id = "sb-close">',["<img src= "+c+'/icon-close.png width="12px"/>'].join("\n"),"</div>",'<div id="sb-logo">',['<img width="26" src= '+c+"/assets/stereopaw-logo-main.png/>"].join("\n"),"</div>",'<div id = "sb-title">',["<img src= "+c+"/stereopaw-marklet-title.png/>"].join("\n"),"</div>"].join("\n"),e=[d,'<div id = "sb-track">',['<div id = "sb-track-title-label" class = "sb-label">Title</div>','<div id = "sb-track-title"></div>','<div id = "sb-track-artist-label" class = "sb-label">Artist</div>','<div id = "sb-track-artist"></div>','<div id = "sb-track-time-label" class = "sb-label">Timestamp</div>','<div id = "sb-time"></div>'].join("\n"),"</div>",'<div id = "sb-player">',['<div id = "sb-display-bar">',['<div id = "sb-display-bar-elapsed"></div>','<div id = "sb-display-seek"></div>'].join("\n"),"</div>"].join("\n"),"</div>",'<div id = "sb-submit">',['<div id="sb-submit-button">Submit</div>'].join("\n"),"</div>"].join("\n"),f=[d,'<div id = "sb-error">',['<div class="sb-service"> This website is not yet supported </div>','<div class="sb-service"> Sorry! </div>'].join("\n"),"</div>"].join("\n"),g={"#sb-app":{position:"fixed !important",top:"50px !important",right:"0 !important",width:"300px","background-color":"#fff",border:"1px solid #aaa","z-index":"99999999999999999","text-align":"left",display:"none"},"#sb-error":{margin:"10px 0px"},".sb-service":{padding:"10px"},"#sb-title":{padding:"10px","margin-top":"8px","border-bottom":"1px solid #000","margin-left":"10px","margin-right":"10px"},"#sb-track":{"margin-left":"10px","font-size":"14px","padding-top":"10px","margin-right":"10px",font:'12px/1.4 "Lucida Grande","Lucida Sans Unicode","Lucida Sans",Garuda,Verdana,Tahoma,sans-serif;'},"#sb-close":{"float":"right",padding:"8px","padding-right":"6px",cursor:"pointer"},"#sb-logo":{"float":"left",padding:"8px","padding-left":"10px","margin-right":"4px"},"#sb-time":{"font-size":"14px"},"#sb-display-bar":{width:"100%",cursor:"pointer",height:"10px","background-color":"#000",display:"none"},"#sb-display-bar-elapsed":{width:"0%",height:"8px","background-color":"#aaa"},".sb-label":{"font-size":"12px","margin-top":"10px",color:"#a2a2a2"},"#sb-track-title":{"font-size":"18px"},"#sb-track-artist":{"font-size":"14px"},"#sb-display-seek":{position:"relative",top:"-8px",width:"2px",height:"10px","background-color":"#eee111",display:"none"},"#sb-submit":{width:"100%;","margin-top":"20px"},"#sb-submit-button":{background:"#0066cc",color:"white",padding:"10px",margin:"10px","text-align":"center","font-size":"14px",cursor:"pointer"}},h={insert_page:function(){console.log("[stereopaw] Page.insert_page()"),b({type:"div",attr:"id",value:"sb-app"},e),b({type:"style",attr:"id",value:"sb-style"},a(g))},insert_error_page:function(){console.log("[stereopaw] Page.insert_error_page()"),b({type:"div",attr:"id",value:"sb-app"},f),b({type:"style",attr:"id",value:"sb-style"},a(g))}};return h}(),SB.Service=function(){function a(){c.some(function(a){return(m=a.exec(e))?d=m[1]:void 0})}var b={},c=[/^https?:\/\/.*(mixcloud).com/g,/^https?:\/\/.*(soundcloud).com/g,/^https?:\/\/.*(youtube).com/g,/^https?:\/\/.*(spotify).com/g],d=null,e=window.location.origin;return b.getService=function(){return null==d&&a(),d?d.toLowerCase():"NA"},b}(),SB.Track=function(){_url="https://ec2-54-220-193-184.eu-west-1.compute.amazonaws.com:5151/tracks/new";var a={},b="",c="",d="",e="",f="",g="",h="",i="",j="",k="",l="",m="";return _service="",_artwork_url="",a.set=function(a,j,k,n,o,p,q,r,s,t,u){c=a,d=j,b=k,e=n,f=o,g=p,i=q,h=r,m=s,_service=t,_artwork_url=u,l=p/o},a.getURL=function(){return _url+"?track[track_id]="+encodeURIComponent(c)+"&track[artist]="+encodeURIComponent(d)+"&track[title]="+encodeURIComponent(b)+"&track[page_url]="+encodeURIComponent(h)+"&track[profile_url]="+encodeURIComponent(e)+"&track[timeformat]="+encodeURIComponent(this.getTimeFormat())+"&track[timestamp]="+encodeURIComponent(g)+"&track[duration]="+encodeURIComponent(f)+"&track[shareable]="+encodeURIComponent(m)+"&track[service]="+encodeURIComponent(_service)+"&track[artwork_url]="+encodeURIComponent(_artwork_url)+"&track[subtrack]="+encodeURIComponent(j)+"&track[subartist]="+encodeURIComponent(k)},a.getTitle=function(){return b},a.getArtist=function(){return d},a.getTimeFormat=function(){return i},a.getElapsed=function(){return l},a.getDuration=function(){return f},a.toJSON=function(){return{track_id:c,title:b,artist:d,profile_url:e,duration:f,timestamp:g,page_url:h,timeformat:i,subtrack:j,subartist:k,elapsed:l,shareable:m,service:_service,artwork_url:_artwork_url,url:a.getURL()}},a}(),SB.Data=function(){function a(a,b,c){try{return a()}catch(d){try{return b()}catch(e){return c}}}function b(){e.set(null,"Please select something to play","Nothing Loaded",null,null,0,"0:00",null,!1,d,null),$("#sb-submit-button").css("display","none")}function c(){_mode==MODE.MARKLET&&(document.getElementById("sb-track-title-label").style.display="block",document.getElementById("sb-track-artist-label").style.display="block",$("#sb-submit-button").css("display","block"))}var d=null,e=null,f=null;_mode=null;var g={mixcloud:function(){c();var d=$(".player").scope();if(d.playerStarted)e.set(a(function(){return d.waveformUrl.match(/([^\/]+)\.json/)[1]},function(){return d.currentCloudcast.url}),d.currentCloudcast.owner,d.currentCloudcast.title,"//www.mixcloud.com"+d.currentCloudcast.ownerUrl,1e3*d.audioLength,d.audioPosition,SB.Util.toTime(d.audioPosition,"secs"),"//www.mixcloud.com"+d.currentCloudcast.url,!0,"mixcloud",d.currentCloudcast.mobilePlayerFullImage);else{if(!$(".cloudcast-head").length)return void b();var f=$(".cloudcast-time").html().match(/(\d+)h/),g=$(".cloudcast-time").html().match(/(\d+)m/);e.set(void 0,$('span[itemprop="name"]').html(),$(".cloudcast-title").html(),"//www.mixcloud.com"+$(".cloudcast-uploader").attr("href"),1e3*SB.Util.textToSecs(f,g,0),0,"0:00",window.location.href.match("[^(http|https):].*"),!0,"mixcloud",$(".cloudcast-image").attr("src"))}},soundcloud:function(){var a=require("lib/play-manager");if(f=a.getCurrentSound(),!f)return void b();c();var g=a.getCurrentMetadata(),h=g.sound.audio.currentTime(),i=g.sound.attributes.artwork_url||g.sound.attributes.user.avatar_url;null==i?"":i.replace("-large.jpg","-t200x200.jpg"),e.set(g.sound.attributes.id,g.sound.attributes.user.username,g.sound.attributes.title,g.sound.attributes.user.permalink_url.replace(/^(http|https):\/\//,"//"),g.sound.attributes.duration,h,SB.Util.toTime(h,"ms"),g.sound.attributes.permalink_url.replace(/^(http|https):\/\//,"//"),"public"==g.sound.attributes.sharing?!0:!1,d,i.replace(/^(http|https):\/\//,"//"))},youtube:function(){null==f&&(f=document.getElementById("movie_player"));var g=a(function(){return document.getElementsByClassName("metadata-info-title")[1].nextSibling.nextSibling.innerHTML},function(){return""},""),h=a(function(){return document.getElementsByClassName("metadata-info-title")[0].innerHTML.match(/"(.*)\"/)[1]},function(){return ytplayer.config.args.title},""),i=a(function(){return f.getCurrentTime()},function(){return 0},0),j=a(function(){return f.getDuration()},function(){return 0},0);return c(),ytplayer.config.args.loaderUrl?void e.set(ytplayer.config.args.video_id,g,h,ytplayer.config.args.loaderUrl.replace(/^(http|https):\/\//,"//"),j,i,SB.Util.toTime(i,"secs"),ytplayer.config.args.loaderUrl.replace(/^(http|https):\/\//,"//"),!0,d,"//img.youtube.com/vi/"+ytplayer.config.args.video_id+"/0.jpg"):void b()},spotify:function(){if(!window.frames[1].document.getElementById("track-name").children[0].href.match(/track\/(.*)/))return void b();var d=SB.Util.TimetoMs(window.frames[1].document.getElementById("track-length").innerHTML),f=SB.Util.TimetoMs(window.frames[1].document.getElementById("track-current").innerHTML);e.set(window.frames[1].document.getElementById("track-name").children[0].href.match(/track\/(.*)/)[1],window.frames[1].document.getElementById("track-artist").children[0].text,window.frames[1].document.getElementById("track-name").children[0].text,window.frames[1].document.getElementById("track-artist").children[0].href.match(/[^(http:||https:)].*/)[0],d,f,window.frames[1].document.getElementById("track-current").innerHTML,window.frames[1].document.getElementById("track-name").children[0].href.match(/[^(http:||https:)].*/)[0],!0,"spotify",a(function(){return window.frames[1].document.getElementsByClassName("sp-image-img")[0].getAttribute("style").match(/\/\/[^);]+/)[0]},function(){return null})),c()},NA:function(){return"NA"}},h={soundcloud:{seek:function(a){f.seek(a*e.getDuration())},pause:function(){},play:function(){}},youtube:{seek:function(a){f.seekTo(a*e.getDuration())},pause:function(){},play:function(){}},NA:function(){return"NA"}},i={};return i.setTrack=function(a,b,c){_mode=a,d=b,e=c,g[d]()},i.seek=function(a){h[d].seek(a)},i}(),SB.init();