console.log("[SoundByte 2.0]");var SB=(function(){self=null,_interval=null,_sbjq=null,service="";var a={init:function(){self=this;self.Util.load_jQuery();_interval=setInterval(function(){if(typeof jQuery=="undefined"){return false}else{clearInterval(_interval);self.start()}},150)},start:function(){console.log("[SoundByte 2.0] start()");self.service=self.Service.getService();console.log("Service: "+self.service);if(!document.getElementById("sb-app")){self.Page.insert_page();self.events()}self.update()},events:function(){console.log("[SoundByte 2.0] events()");$("#sb-close").bind("click",function(){console.log("[SoundByte 2.0] Exiting");clearInterval(self._interval);$("sb-close").unbind("click");$("#sb-script").remove();$("#sb-style").remove();$("#sb-app").remove()});$("#sb-submit-button").bind("click",function(b){b.preventDefault();window.open(self.Track.getURL(),"SoundByte","top=0,left=0,width=600, height=500");console.log("clicked")})},update:function(){console.log("[SoundByte 2.0] update()");self._interval=setInterval(function(){self.Data.setTrack(self.service,self.Track);self.render()},300)},render:function(){console.log("[SoundByte 2.0] render()");if($("#sb-app").is(":hidden")){$("#sb-app").fadeIn()}document.getElementById("sb-track-title").innerHTML=self.Track.getTitle();document.getElementById("sb-track-artist").innerHTML=self.Track.getArtist();document.getElementById("sb-track-service").innerHTML=self.service;document.getElementById("sb-time").innerHTML=self.Track.getTimeFormat();document.getElementById("sb-display-bar-elapsed").setAttribute("style","width: "+self.Track.getElapsed()*100+"%;")}};return a}());SB.Util=(function(){var a={};function b(d){return(d.toFixed().length>1?d.toFixed():"0"+d.toFixed())}function c(d,e,f){if(d<1){return e+":"+b(f)}return d+":"+b(e)+":"+b(f)}a.toTime=function(f,i){var h=(i=="secs")?1:1000;var d=Math.floor(f/(3600*h));var e=Math.floor((f/(60*h))-60*d);var g=(f/(60*h)-(60*d)-e)*60;if(i=="secs"){return c(d,e,Math.round(g))}return c(d,e,Math.floor(g))};a.load_jQuery=function(){if(typeof jQuery==="undefined"){var d=document.createElement("script");d.id="sb-jb";d.type="text/javascript";d.src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js";document.body.appendChild(d)}};return a}());SB.Page=(function(){_content='<div id = "sb-close">x</div><h1 id = "sb-title">SoundByte</h1><div id = "sb-track"><div id = "sb-track-title"></div><div id = "sb-track-artist"></div><div id = "sb-track-service"></div></div><div id = "sb-player"><div id = "sb-time"></div><div id = "sb-display-bar"><div id = "sb-display-bar-elapsed"></div></div><div id = "sb-player-play">></div></div><div id = "sb-submit">     <button id = "sb-submit-button">Submit</button></div></div>';_style="#sb-app { position: fixed; top: 50px; right: 0; width: 300px;background-color: #fff;border: 1px solid #aaa;z-index: 99999999999999999;display:none}#sb-close { float:right;}#sb-display-bar { width: 100%;height: 10px;background-color: #000;}#sb-display-bar-elapsed { width: 0%;height: 8px;background-color: #aaa}";function a(c,d){var f=document.createElement(c.type);f.setAttribute(c.attr,c.value);f.innerHTML=d;document.body.appendChild(f)}var b={insert_page:function(){a({type:"div",attr:"id",value:"sb-app"},_content);a({type:"style",attr:"id",value:"sb-style"},_style)}};return b}());SB.Service=(function(){var a={};_services=[/^https?:\/\/.*(mixcloud).com/g,/^https?:\/\/.*(soundcloud).com/g],_match=null;_locale=window.location.origin;function b(){_services.some(function(c){if(m=c.exec(_locale)){return _match=m[1]}})}a.getService=function(){if(_match==null){b()}return _match?_match.toLowerCase():"NA"};return a}());SB.Track=(function(){_url="http://ec2-54-220-193-184.eu-west-1.compute.amazonaws.com:5151/tracks/new";var a={};_title="",_artist="",_profile_url="",_duration="",_timestamp="",_page_url="",_timeformat="",_subtrack="",_subartist="",_elapsed="";a.set=function(c,h,g,f,e,b,d){_artist=c;_title=h;_profile_url=g;_duration=f;_timestamp=e;_timeformat=b;_page_url=d;_elapsed=e/f};a.getURL=function(){return _url+"?track[artist]="+encodeURIComponent(_artist)+"&track[title]="+encodeURIComponent(_title)+"&track[page_url]="+encodeURIComponent(_page_url)+"&track[profile_url]="+encodeURIComponent(_profile_url)+"&track[timeformat]="+encodeURIComponent(this.getTimeFormat())+"&track[timestamp]="+encodeURIComponent(_timestamp)+"&track[duration]="+encodeURIComponent(_duration)+"&track[subtrack]="+encodeURIComponent(_subtrack)+"&track[subartist]="+encodeURIComponent(_subartist)};a.getTitle=function(){return _title};a.getArtist=function(){return _artist};a.getTimeFormat=function(){return _timeformat};a.getElapsed=function(){return _elapsed};return a}());SB.Data=(function(){_service=null;_track=null;function a(c,g,f){try{return c()}catch(e){try{return g()}catch(d){return f}}}_set={mixcloud:function(){var d={},c;d=a(function(){return $("#player-module").data()["controller:player_module"].playerStatus},function(){return 0},{});c=a(function(){return d.audio_position},function(){return 0},0);_track.set(a(function(){return $("#cloudcast-owner-link > span")[0].innerHTML},function(){return $("#cloudcast-owner-link")[0].innerHTML},""),$("#cloudcast-name").html(),"http://www.mixcloud.com"+$("#cloudcast-owner-link").attr("href"),d.now_playing_audio_length,c,SB.Util.toTime(c,"secs"),"http://www.mixcloud.com"+d.now_playing_key)},soundcloud:function(){var d=require("lib/play-manager");var e=d.getCurrentMetadata();var c=e.sound.audio.currentTime();_track.set(e.sound.attributes.user.username,e.sound.attributes.title,e.sound.attributes.user.permalink_url,e.sound.attributes.duration,c,SB.Util.toTime(c,"ms"),e.sound.attributes.permalink_url)},spotify:function(){},youtube:function(){},grooveshark:function(){},"8tracks":function(){},pandora:function(){},NA:function(){return"NA"}};var b={};b.setTrack=function(c,d){_service=c;_track=d;_set[_service]()};return b}());SB.init();